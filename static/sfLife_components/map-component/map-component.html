<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="map-component">
    <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../../bower_components/d3/d3.min.js"></script>
    <template>
        <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
        <div id="map"></div>

    </template>

    <script>
        Polymer({
            ready: function() {
                var arr = [];
                var rates = [];
                var map = d3.select('#map').append('svg'),
                    //path = d3.geo.path().projection(d3.geo.albers().origin([-122.4192, 37.7793]).scale(90000).translate([122, 55]));
                    path = d3.geo.path().projection(d3.geo.albers().origin([-122.4031949051393, 37.80511854740679]).scale(90000).translate([122, 55]));


                d3.json('static/data/AsthmaRates_CB00.json', function(json) {
                    map.selectAll('path')
                        .data(json.features)
                        .enter().append('path')
                        .attr('d', path)
                        .attr('class', function(d) {
                            console.log('zip z' + d.id);
                            arr.push(d.id);
                            return 'zip z' + d.id
                        })
                        .on('mouseover', function() {
                            var zip = d3.select(this).attr('class').split('zip z').join('');
                            console.log('zip ' + zip + ' selected');

                            d3.select('#map').selectAll('p').text('');
                            for (key in arr) {
                                //console.log(arr[key]);
                                d3.select('#map .z' + parseInt(arr[key])).style("fill", "black");
                            }

                            d3.select('#map .z' + zip).style("fill", "purple");
                            d3.select('#map').append('p').text(zip);

                            //Sample -- d3.select('#map .z94110').style("fill", "purple");

                            //highlightZip(zip);
                        })
                        .on('mouseout', function() {
                            d3.selectAll('#vis .zip').style("fill", "black");
                            /* unhighlightZip();
                             d3.selectAll('#vis .zip')
                                 .classed('sel', false)
                                 .classed('fade', false);
                             hideTip(); */
                        });
                    map.append('text')
                        .attr('x', 30)
                        .attr('y', 190)
                        .text('San Francisco, CA')
                }); 
            }
        });
    </script>
</polymer-element>